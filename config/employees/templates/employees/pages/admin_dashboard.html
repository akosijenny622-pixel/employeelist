{% extends 'employees/templates/base.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Admin Dashboard</h2>
  {% include 'employees/atoms/alert.html' %}

  <!-- Search & filters (same layout as the employee list) -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="get" class="row g-3">
        <div class="col-md-4">
          <label for="q" class="form-label">Search</label>
          <input type="text" class="form-control" id="q" name="q" value="{{ query }}" placeholder="Search by ID, name, or position">
        </div>
        <div class="col-md-3">
          <label for="department" class="form-label">Department</label>
          <select class="form-select" id="department" name="department">
            <option value="">All Departments</option>
            {% for dept_code, dept_name in departments %}
              <option value="{{ dept_code }}" {% if department == dept_code %}selected{% endif %}>{{ dept_name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <label for="status" class="form-label">Status</label>
          <select class="form-select" id="status" name="status">
            <option value="">All Statuses</option>
            {% for status_code, status_name in statuses %}
              <option value="{{ status_code }}" {% if status == status_code %}selected{% endif %}>{{ status_name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-outline-primary w-100">
            <i class="fas fa-search me-1"></i>Search
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-center bg-primary text-white">
        <div class="card-body">
          <h2 class="display-4">{{ total_employees }}</h2>
          <p class="mb-0">Total Employees</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center bg-success text-white">
        <div class="card-body">
          <h2 class="display-4">{{ active_employees }}</h2>
          <p class="mb-0">Active Employees</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center bg-info text-white">
        <div class="card-body">
          <h2 class="display-4">{{ departments|length }}</h2>
          <p class="mb-0">Departments</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h5 class="mb-0">Employee Management</h5>
          <a href="{% url 'employee_create' %}" class="btn btn-primary"
            >Add New Employee</a
          >
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                    <th>Name</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Department</th>
                    <th>Position</th>
                    <th>Hire Date</th>
                    <th>Salary</th>
                    <th>Status</th>
                    <th>Address</th>
                    <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for employee in employees %}
                <tr>
                  <td>{{ employee.employee_id }}</td>
                  <td>{{ employee.user.get_full_name }}</td>
                  <td>{{ employee.user.username }}</td>
                  <td>{{ employee.user.email }}</td>
                  <td>{{ employee.user.phone|default:'N/A' }}</td>
                  <td>{{ employee.get_department_display }}</td>
                  <td>{{ employee.position }}</td>
                  <td>{{ employee.hire_date }}</td>
                  <td>{{ employee.salary }}</td>
                  <td>
                    {% if employee.status == 'active' %}
                    <span class="badge bg-success">Active</span>
                    {% elif employee.status == 'inactive' %}
                    <span class="badge bg-danger">Inactive</span>
                    {% else %}
                    <span class="badge bg-warning">On Leave</span>
                    {% endif %}
                  </td>
                  <td>{{ employee.address|default:'N/A' }}</td>
                  <td>
                    <a href="{% url 'employee_detail' employee.pk %}" class="btn btn-sm btn-info">View</a>
                    <a href="{% url 'employee_update' employee.pk %}" class="btn btn-sm btn-warning">Edit</a>
                    <a href="{% url 'employee_delete' employee.pk %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this employee? This action cannot be undone.');">Delete</a>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6" class="text-center">No employees found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
