{% extends 'employees/templates/base.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
<div class="container mt-4 slide-up">
  <div class="mb-4">
    <h2 class="gradient-text mb-2"><i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard</h2>
    <p class="text-muted">Manage and monitor your employee database</p>
  </div>
  {% include 'employees/atoms/alert.html' %}

  <!-- Search & filters (same layout as the employee list) -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="get" class="row g-3">
        <div class="col-md-4">
          <label for="q" class="form-label">Search</label>
          <input type="text" class="form-control" id="q" name="q" value="{{ query }}"
            placeholder="Search by ID, name, or position">
        </div>
        <div class="col-md-3">
          <label for="department" class="form-label">Department</label>
          <select class="form-select" id="department" name="department">
            <option value="">All Departments</option>
            {% for dept_code, dept_name in departments %}
            <option value="{{ dept_code }}" {% if department == dept_code %}selected{% endif %}>{{ dept_name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <label for="status" class="form-label">Status</label>
          <select class="form-select" id="status" name="status">
            <option value="">All Statuses</option>
            {% for status_code, status_name in statuses %}
            <option value="{{ status_code }}" {% if status == status_code %}selected{% endif %}>{{ status_name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-outline-primary w-100">
            <i class="fas fa-search me-1"></i>Search
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="row mb-4 fade-in">
    <div class="col-md-4 mb-3 mb-md-0">
      <div class="card stats-card-primary text-white">
        <div class="card-body text-center position-relative">
          <div class="mb-2">
            <i class="fas fa-users fa-2x opacity-75"></i>
          </div>
          <h2 class="display-4 fw-bold mb-2">{{ total_employees }}</h2>
          <p class="mb-0 text-uppercase fw-semibold" style="letter-spacing: 1px;">Total Employees</p>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-3 mb-md-0">
      <div class="card stats-card-success text-white">
        <div class="card-body text-center">
          <div class="mb-2">
            <i class="fas fa-user-check fa-2x opacity-75"></i>
          </div>
          <h2 class="display-4 fw-bold mb-2">{{ active_employees }}</h2>
          <p class="mb-0 text-uppercase fw-semibold" style="letter-spacing: 1px;">Active Employees</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card stats-card-info text-white">
        <div class="card-body text-center">
          <div class="mb-2">
            <i class="fas fa-building fa-2x opacity-75"></i>
          </div>
          <h2 class="display-4 fw-bold mb-2">{{ departments|length }}</h2>
          <p class="mb-0 text-uppercase fw-semibold" style="letter-spacing: 1px;">Departments</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Employee Management</h5>
          <a href="{% url 'employee_create' %}" class="btn btn-primary">Add New Employee</a>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Department</th>
                  <th>Position</th>
                  <th>Hire Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for employee in employees %}
                <tr>
                  <td>{{ employee.employee_id }}</td>
                  <td>{{ employee.user.get_full_name|default:employee.user.username }}</td>
                  <td>{{ employee.get_department_display }}</td>
                  <td>{{ employee.position }}</td>
                  <td>{{ employee.hire_date }}</td>
                  <td>
                    {% if employee.status == 'active' %}
                    <span class="badge bg-success">Active</span>
                    {% elif employee.status == 'inactive' %}
                    <span class="badge bg-danger">Inactive</span>
                    {% else %}
                    <span class="badge bg-warning">On Leave</span>
                    {% endif %}
                  </td>
                  <td>
                    <a href="{% url 'employee_detail' employee.pk %}" class="btn btn-sm btn-info">View</a>
                    <a href="{% url 'employee_update' employee.pk %}" class="btn btn-sm btn-warning">Edit</a>
                    <a href="{% url 'employee_delete' employee.pk %}" class="btn btn-sm btn-danger"
                      onclick="return confirm('Are you sure you want to delete this employee? This action cannot be undone.');">Delete</a>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="7" class="text-center">No employees found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}